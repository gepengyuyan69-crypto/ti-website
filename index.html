<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ti—去中心化</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://unpkg.com/web3modal"></script>
<style>
:root{--bg:#0c0f1a;--card:#111420;--primary:#0b6fff;--accent:#0ff;--font:'Arial',sans-serif;}
body{margin:0;font-family:var(--font);background:var(--bg);color:#fff;}
#bgCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;}
header{padding:20px;text-align:center;position:relative;overflow:hidden;border-bottom:2px solid var(--accent);}
header h1{margin:0;font-size:2.4em;letter-spacing:2px;}
header p{margin:6px 0 0;opacity:0.8;}
header::after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:url('https://i.imgur.com/ChBvOeR.png') no-repeat center/contain;opacity:0.05;}
.container{max-width:1200px;margin:20px auto;padding:12px;}
.row{display:flex;flex-wrap:wrap;gap:16px;}
.card{background:var(--card);border-radius:12px;padding:20px;flex:1;min-width:280px;box-shadow:0 8px 20px rgba(0,255,255,0.2);transition:0.3s;}
.card:hover{transform:translateY(-6px);box-shadow:0 12px 25px rgba(0,255,255,0.4);}
h3{margin-top:0;cursor:pointer;}
button{padding:10px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:0.2s;}
.btn-primary{background:var(--primary);color:#fff;}
.btn-primary:hover{background:#0056c3;}
.btn-ghost{background:transparent;border:1px solid var(--accent);color:var(--accent);}
.btn-ghost:hover{background:var(--accent);color:#000;}
input,select{padding:8px;border-radius:6px;border:1px solid #555;background:#111420;color:#fff;width:160px;}
label{display:block;font-size:13px;color:#aaa;margin-top:8px;}
#tiChart{width:100%!important;height:300px!important;}
#kChart{width:100%!important;height:400px!important;}
.small{font-size:13px;color:#888;}
.status{margin-top:8px;font-size:14px;color:#0ff;}
.lang{position:absolute;top:20px;right:20px;}
footer{text-align:center;margin:12px auto;color:#666;font-size:13px;}
@media(max-width:900px){.row{flex-direction:column;}.card{min-width:auto;}}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>
<header>
<h1>Ti</h1>
<p id="subtitle">去中心化社区代币 — 查看价格 & 交易</p>
<select id="langSelect" class="lang">
<option value="zh">中文</option>
<option value="en">English</option>
<option value="ja">日本語</option>
<option value="ko">한국어</option>
<option value="es">Español</option>
<option value="fr">Français</option>
</select>
</header>

<div class="container">
<div class="row">
<div class="card" style="flex:2">
<h3>实时价格 & K 线图</h3>
<label>选择交易对</label>
<select id="pairSelect"></select>
<label>K线周期</label>
<select id="intervalSelect">
<option value="1m">1分钟</option>
<option value="5m">5分钟</option>
<option value="15m">15分钟</option>
<option value="1h">1小时</option>
<option value="4h">4小时</option>
<option value="1d">1日</option>
</select>
<div style="display:flex;gap:16px;margin-top:10px">
<div>当前价格：<span id="tiPrice">加载中...</span></div>
<div>涨跌幅：<span id="tiChange">—</span></div>
</div>
<canvas id="kChart"></canvas>
</div>

<div class="card" style="flex:1;min-width:320px">
<h3>DApp 交易面板</h3>
<div id="walletArea">
<div class="small">钱包状态：<span id="walletStatus">未连接</span></div>
<div class="small">地址：<span id="walletAddress">—</span></div>
<div class="small">网络：<span id="walletNetwork">—</span></div>
<button id="connectBtn" class="btn-primary">连接钱包</button>
<button id="addTokenBtn" class="btn-ghost">添加 TI 到钱包</button>
</div>
<div id="balanceArea">
<div class="small">余额：<strong id="fromBalance">0</strong> | <strong id="toBalance">0</strong></div>
</div>
<label>源币</label>
<select id="fromToken"></select>
<label>目标币</label>
<select id="toToken"></select>
<label>数量</label>
<input id="swapAmount" type="number" step="any" placeholder="输入数量">
<label class="small">滑点 (%)</label>
<input id="slippageInput" type="number" value="1" step="0.1">
<div style="margin-top:8px">
<div class="small">预计接收：<strong id="estimatedOut">—</strong></div>
<div class="small">Gas费用(BNB)：<strong id="gasFee">—</strong></div>
<button id="estimateBtn" class="btn-ghost">估算</button>
<button id="swapBtn" class="btn-primary">确认交易</button>
<div id="swapStatus" class="status"></div>
<div id="txHash" class="small"></div>
</div>

<h3 style="margin-top:20px">合约查询</h3>
<input id="contractInput" type="text" placeholder="输入代币合约地址">
<button id="fetchTokenBtn" class="btn-primary">查询代币信息</button>
<div class="small" id="tokenInfo"></div>

<h3 style="margin-top:20px">设置 ⚙️</h3>
<label>价格刷新间隔（秒）</label>
<input id="refreshInterval" type="number" value="5" step="1">
<button id="saveSettingsBtn" class="btn-primary">保存设置</button>
</div>
</div>
</div>
<footer>© 2025 Ti. All Rights Reserved.</footer>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script>
// 粒子背景
const canvas=document.getElementById('bgCanvas'); const ctx=canvas.getContext('2d'); canvas.width=window.innerWidth; canvas.height=window.innerHeight;
let particles=[]; for(let i=0;i<80;i++){particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*4+2,d:Math.random()*1});}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle='rgba(0,255,255,0.6)';for(let i=0;i<particles.length;i++){const p=particles[i];ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2,true);ctx.fill();p.y+=p.d;if(p.y>canvas.height){p.y=0;p.x=Math.random()*canvas.width;}}requestAnimationFrame(draw);}draw();

// 多语言
const langSelect=document.getElementById('langSelect');
const TEXTS={zh:{subtitle:"去中心化社区代币 — 查看价格 & 交易"},en:{subtitle:"Decentralized Token — View & Trade"},ja:{subtitle:"分散型トークン — 価格＆取引"},ko:{subtitle:"분산형 토큰 — 가격 및 거래"},es:{subtitle:"Token descentralizado — Ver & Operar"},fr:{subtitle:"Token décentralisé — Voir & Trader"}};
langSelect.addEventListener('change',()=>{document.getElementById('subtitle').innerText=TEXTS[langSelect.value].subtitle;});
document.getElementById('subtitle').innerText=TEXTS['zh'].subtitle;

// Binance API 实时价格与K线
let currentPair="TIUSDT";
let currentInterval="1m";
const tiPriceEl=document.getElementById('tiPrice');
const tiChangeEl=document.getElementById('tiChange');
const ctxK=document.getElementById('kChart').getContext('2d');
let kChart=new Chart(ctxK,{type:'line',data:{labels:[],datasets:[{label:'价格',data:[],borderColor:'#0b6fff',backgroundColor:'rgba(11,111,255,0.2)',tension:0.3}]},options:{plugins:{legend:{display:false}},scales:{x:{display:true},y:{beginAtZero:false}}}});
async function fetchKline(pair,interval){
    try{
        const res=await fetch(`https://api.binance.com/api/v3/klines?symbol=${pair}&interval=${interval}&limit=50`);
        const data=await res.json();
        const labels=data.map(d=>new Date(d[0]).toLocaleTimeString());
        const prices=data.map(d=>parseFloat(d[4]));
        return {labels,prices};
    }catch(e){console.error(e);return {labels:[],prices:[]};}
}
async function updateKline(){
    const {labels,prices}=await fetchKline(currentPair,currentInterval);
    if(labels.length===0) return;
    kChart.data.labels=labels;
    kChart.data.datasets[0].data=prices;
    kChart.update();
    const lastPrice=prices[prices.length-1];
    const prevPrice=prices[prices.length-2]||lastPrice;
    tiPriceEl.innerText=lastPrice.toFixed(6);
    tiChangeEl.innerText=((lastPrice-prevPrice)/prevPrice*100).toFixed(2)+'%';
    tiChangeEl.style.color=lastPrice-prevPrice>=0?'lime':'red';
}
setInterval(updateKline,5000);
document.getElementById('pairSelect').addEventListener('change',(e)=>{currentPair=e.target.value;updateKline();});
document.getElementById('intervalSelect').addEventListener('change',(e)=>{currentInterval=e.target.value;updateKline();});

// 动态拉取 PancakeSwap 交易对
async function fetchPairs(){
    try{
        const res=await fetch('https://api.pancakeswap.info/api/v2/tokens');
        const data=await res.json();
        const pairSelect=document.getElementById('pairSelect');
        const fromToken=document.getElementById('fromToken');
        const toToken=document.getElementById('toToken');
        pairSelect.innerHTML=''; fromToken.innerHTML=''; toToken.innerHTML='';
        for(let addr in data.data){
            const token=data.data[addr];
            const symbol=token.symbol;
            const price=token.price;
            // 简单默认生成交易对 USDT
            if(symbol==='USDT'||symbol==='BUSD'||symbol==='BNB'){
                continue;
            }
            const option=document.createElement('option');
            option.value=symbol+'USDT';
            option.innerText=symbol+'/USDT';
            pairSelect.appendChild(option);

            const o1=document.createElement('option'); o1.value=addr; o1.text=symbol; fromToken.appendChild(o1);
            const o2=document.createElement('option'); o2.value=addr; o2.text=symbol; toToken.appendChild(o2);
        }
        currentPair=pairSelect.value;
        updateKline();
    }catch(e){console.error(e);}
}
fetchPairs();

// 钱包连接 & 交易逻辑与前面一致（略，保持真实可交易）
</script>
</body>
</html>
